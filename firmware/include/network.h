/**
 * =============================================================================
 * @file    network.h
 * @brief   Заголовочный файл сетевого стека
 * =============================================================================
 * 
 * @author  Reconstructed from Avalon A1126pro firmware
 * @version 1.0
 * =============================================================================
 */

#ifndef _NETWORK_H_
#define _NETWORK_H_

#include <stdint.h>
#include <stdbool.h>

#ifdef __cplusplus
extern "C" {
#endif

/* =============================================================================
 * СТРУКТУРЫ ДАННЫХ
 * ============================================================================= */

/**
 * @brief Структура сетевой конфигурации
 */
typedef struct {
    bool dhcp;              /**< Использовать DHCP */
    uint8_t ip[4];          /**< IP адрес */
    uint8_t netmask[4];     /**< Маска подсети */
    uint8_t gateway[4];     /**< Шлюз по умолчанию */
    uint8_t dns[4];         /**< DNS сервер */
    char hostname[32];      /**< Имя хоста */
} network_config_t;

/* =============================================================================
 * ФУНКЦИИ ИНИЦИАЛИЗАЦИИ
 * ============================================================================= */

/**
 * @brief Инициализация сетевого стека
 * @return 0 при успехе, <0 при ошибке
 */
int network_init(void);

/**
 * @brief Обработка сетевого стека
 * 
 * Должна вызываться периодически из сетевой задачи.
 */
void network_poll(void);

/* =============================================================================
 * ФУНКЦИИ ПРОВЕРКИ СОСТОЯНИЯ
 * ============================================================================= */

/**
 * @brief Проверка подключения к сети
 * @return true если есть IP адрес
 */
bool network_is_connected(void);

/**
 * @brief Проверка использования DHCP
 * @return true если используется DHCP
 */
bool network_is_dhcp(void);

/* =============================================================================
 * ФУНКЦИИ ПОЛУЧЕНИЯ ИНФОРМАЦИИ
 * ============================================================================= */

/**
 * @brief Получение IP адреса
 * @param ip_str [out] Строка для IP адреса (минимум 16 символов)
 */
void network_get_ip(char *ip_str);

/**
 * @brief Получение маски подсети
 * @param netmask_str [out] Строка для маски (минимум 16 символов)
 */
void network_get_netmask(char *netmask_str);

/**
 * @brief Получение шлюза
 * @param gateway_str [out] Строка для шлюза (минимум 16 символов)
 */
void network_get_gateway(char *gateway_str);

/**
 * @brief Получение DNS сервера
 * @param dns_str [out] Строка для DNS (минимум 16 символов)
 */
void network_get_dns(char *dns_str);

/**
 * @brief Получение MAC адреса
 * @param mac_str [out] Строка для MAC (минимум 18 символов)
 */
void network_get_mac(char *mac_str);

/**
 * @brief Получение имени хоста
 * @param hostname [out] Строка для имени хоста
 */
void network_get_hostname(char *hostname);

/* =============================================================================
 * ФУНКЦИИ НАСТРОЙКИ
 * ============================================================================= */

/**
 * @brief Установка статического IP адреса
 * @param ip IP адрес (4 байта)
 * @param netmask Маска подсети (4 байта)
 * @param gateway Шлюз (4 байта)
 * @return 0 при успехе
 */
int network_set_static_ip(const uint8_t *ip, const uint8_t *netmask, const uint8_t *gateway);

/**
 * @brief Включение DHCP
 * @return 0 при успехе
 */
int network_enable_dhcp(void);

/**
 * @brief Установка DNS сервера
 * @param dns IP адрес DNS (4 байта)
 * @return 0 при успехе
 */
int network_set_dns(const uint8_t *dns);

/**
 * @brief Установка имени хоста
 * @param hostname Имя хоста
 * @return 0 при успехе
 */
int network_set_hostname(const char *hostname);

/* =============================================================================
 * СОХРАНЕНИЕ/ЗАГРУЗКА КОНФИГУРАЦИИ
 * ============================================================================= */

/**
 * @brief Сохранение сетевой конфигурации
 * @return 0 при успехе
 */
int network_save_config(void);

/**
 * @brief Загрузка сетевой конфигурации
 * @return 0 при успехе
 */
int network_load_config(void);

#ifdef __cplusplus
}
#endif

#endif /* _NETWORK_H_ */
