# Ghidra script for Avalon A1126pro firmware
# Auto-generated by firmware_analyzer.py

from ghidra.program.model.symbol import SourceType
from ghidra.program.model.data import StringDataType

# Memory regions for K210
SRAM_BASE = 0x80000000
FLASH_BASE = 0x00000000

# Known function addresses (from string analysis)
FUNCTIONS = {
    0x000A2585: "avalon10_statline_before",
    0x000A25A5: "avalon10_prepare",
    0x000A25BD: "avalon10_sswork_update",
    0x000A25D5: "avalon10_scanhash",
    0x000A25ED: "avalon10_auc_detect_old",
    0x000A4534: "avalon10_device_freq",
    0x000A456A: "avalon10_device_freq",
    0x000A45A1: "avalon10_device_freq",
    0x000A45DB: "avalon10_device_freq",
    0x000A4610: "avalon10_device_freq",
    0x000A4681: "avalon10_device_hash_od",
    0x000A46BA: "avalon10_device_hash_od",
    0x000A475A: "avalon10_device_smart_speed",
    0x000A47CA: "avalon10_device_ssdn_pro",
    0x000A4821: "avalon10_device_voltage_level",
    0x000A4862: "avalon10_device_voltage_level",
    0x000A48A0: "avalon10_device_voltage_level",
    0x000A496A: "avalon10_factory_pll_info",
    0x000A49D2: "avalon10_factory_volt_info",
    0x000A4A39: "avalon10_fan_speed_info",
    0x000A4ABA: "avalon10_freq_range_high_info",
    0x000A4AFA: "avalon10_freq_range_high_info",
    0x000A4B5A: "avalon10_freq_range_low_info",
    0x000A4B9A: "avalon10_freq_range_low_info",
    0x000A4C4A: "avalon10_pll_select",
    0x000A4C86: "avalon10_target_temp_info",
    0x000A4CC2: "avalon10_target_temp_info",
    0x000A4F3A: "avalon10_volt_adjust_period_info",
    0x000A4F7A: "avalon10_volt_adjust_period_info",
    0x000A4FE2: "avalon10_volt_adjust_switch_info",
    0x000A5022: "avalon10_volt_adjust_switch_info",
    0x000A508A: "avalon10_volt_offset",
    0x000A50DA: "avalon10_volt_range_high_info",
    0x000A511A: "avalon10_volt_range_high_info",
    0x000A517A: "avalon10_volt_range_low_info",
    0x000A51BA: "avalon10_volt_range_low_info",
    0x00262585: "avalon10_statline_before",
    0x002625A5: "avalon10_prepare",
    0x002625BD: "avalon10_sswork_update",
    0x002625D5: "avalon10_scanhash",
    0x002625ED: "avalon10_auc_detect_old",
    0x00264534: "avalon10_device_freq",
    0x0026456A: "avalon10_device_freq",
    0x002645A1: "avalon10_device_freq",
    0x002645DB: "avalon10_device_freq",
    0x00264610: "avalon10_device_freq",
    0x00264681: "avalon10_device_hash_od",
    0x002646BA: "avalon10_device_hash_od",
    0x0026475A: "avalon10_device_smart_speed",
    0x002647CA: "avalon10_device_ssdn_pro",
    0x00264821: "avalon10_device_voltage_level",
    0x00264862: "avalon10_device_voltage_level",
    0x002648A0: "avalon10_device_voltage_level",
    0x0026496A: "avalon10_factory_pll_info",
    0x002649D2: "avalon10_factory_volt_info",
    0x00264A39: "avalon10_fan_speed_info",
    0x00264ABA: "avalon10_freq_range_high_info",
    0x00264AFA: "avalon10_freq_range_high_info",
    0x00264B5A: "avalon10_freq_range_low_info",
    0x00264B9A: "avalon10_freq_range_low_info",
    0x00264C4A: "avalon10_pll_select",
    0x00264C86: "avalon10_target_temp_info",
    0x00264CC2: "avalon10_target_temp_info",
    0x00264F3A: "avalon10_volt_adjust_period_info",
    0x00264F7A: "avalon10_volt_adjust_period_info",
    0x00264FE2: "avalon10_volt_adjust_switch_info",
    0x00265022: "avalon10_volt_adjust_switch_info",
    0x0026508A: "avalon10_volt_offset",
    0x002650DA: "avalon10_volt_range_high_info",
    0x0026511A: "avalon10_volt_range_high_info",
    0x0026517A: "avalon10_volt_range_low_info",
    0x002651BA: "avalon10_volt_range_low_info",
    0x0009DE65: "cgminer_thread",
    0x0025DE65: "cgminer_thread",
    0x0009DDD5: "miner_thread",
    0x0009DE67: "miner_thread",
    0x000A40ED: "miner_id",
    0x000A81AE: "miner_id",
    0x000ACFAB: "miner_name",
    0x000ADA78: "miner_name",
    0x000B2CEB: "miner_name",
    0x000B4555: "miner_name",
    0x000BAA49: "miner_name",
    0x000BB762: "miner_name",
    0x000C48CB: "miner_name",
    0x000C64E2: "miner_name",
    0x000CDA09: "miner_name",
    0x000CE7A6: "miner_name",
    0x000D4167: "miner_name",
    0x000D68AC: "miner_name",
    0x000D6D65: "miner_fan",
    0x0025DDD5: "miner_thread",
    0x0025DE67: "miner_thread",
    0x002640ED: "miner_id",
    0x002681AE: "miner_id",
    0x0026CFAB: "miner_name",
    0x0026DA78: "miner_name",
    0x00272CEB: "miner_name",
    0x00274555: "miner_name",
    0x0027AA49: "miner_name",
    0x0027B762: "miner_name",
    0x002848CB: "miner_name",
    0x002864E2: "miner_name",
    0x0028DA09: "miner_name",
    0x0028E7A6: "miner_name",
    0x00294167: "miner_name",
    0x002968AC: "miner_name",
    0x00296D65: "miner_fan",
    0x0009DB2D: "pool_tset",
    0x0009DB3D: "pool_tclear",
    0x0009DCEB: "pool_work",
    0x0009DE32: "pool_thread",
    0x0009F3DA: "pool_thread",
    0x000A2562: "pool_stratum",
    0x000A411D: "pool_no",
    0x000B6F86: "pool_share_log",
    0x000E2572: "POOL_BUFSIZE",
    0x0025DB2D: "pool_tset",
    0x0025DB3D: "pool_tclear",
    0x0025DCEB: "pool_work",
    0x0025DE32: "pool_thread",
    0x0025F3DA: "pool_thread",
    0x00262562: "pool_stratum",
    0x0026411D: "pool_no",
    0x00276F86: "pool_share_log",
    0x002A2572: "POOL_BUFSIZE",
    0x000E1195: "lwip_netconn_do_writemore",
    0x000E14ED: "lwip_bind",
    0x000E1525: "lwip_connect",
    0x000E15F5: "lwip_recvfrom_udp_raw",
    0x000E16A5: "lwip_sendto",
    0x000E3C4B: "LWIP_UINT32_MAX",
    0x002A1195: "lwip_netconn_do_writemore",
    0x002A14ED: "lwip_bind",
    0x002A1525: "lwip_connect",
    0x002A15F5: "lwip_recvfrom_udp_raw",
    0x002A16A5: "lwip_sendto",
    0x002A3C4B: "LWIP_UINT32_MAX",
    0x000A958C: "SPI_read_n_byte",
    0x000A95B4: "SPI_write_n_byte",
    0x000E4AAF: "SPI_DEVICE",
    0x000E502B: "SPI_FF_STANDARD",
    0x000E5153: "SPI_FF_STANDARD",
    0x0026958C: "SPI_read_n_byte",
    0x002695B4: "SPI_write_n_byte",
    0x002A4AAF: "SPI_DEVICE",
    0x002A502B: "SPI_FF_STANDARD",
    0x002A5153: "SPI_FF_STANDARD",
    0x000E5591: "UART_STOP_2",
    0x000E55A9: "UART_STOP_1_5",
    0x002A5591: "UART_STOP_2",
    0x002A55A9: "UART_STOP_1_5",
    0x000A8BCB: "i2c_error",
    0x000E4957: "I2C_DEVICE",
    0x00268BCB: "i2c_error",
    0x002A4957: "I2C_DEVICE",
    0x000E62CC: "PLIC_NUM_SOURCES",
    0x002A62CC: "PLIC_NUM_SOURCES",
}

# Apply function names
for addr, name in FUNCTIONS.items():
    try:
        func = getFunctionAt(toAddr(addr))
        if func:
            func.setName(name, SourceType.USER_DEFINED)
    except:
        pass

print("Avalon A1126pro firmware symbols applied")
