/**
 * =============================================================================
 * @file    api.h
 * @brief   Avalon A1126pro - CGMiner API сервер (заголовочный файл)
 * @version 1.0
 * @date    2024
 * =============================================================================
 * 
 * ОПИСАНИЕ:
 * CGMiner API сервер на порту 4028.
 * Позволяет удалённо мониторить и управлять майнером.
 * 
 * ПОДДЕРЖИВАЕМЫЕ КОМАНДЫ:
 * - version   - версия ПО
 * - summary   - общая статистика
 * - pools     - информация о пулах
 * - devs      - информация об устройствах
 * - config    - конфигурация
 * - stats     - детальная статистика
 * - restart   - перезапуск майнера
 * 
 * =============================================================================
 */

#ifndef __API_H__
#define __API_H__

#include <stdint.h>

/* ===========================================================================
 * КОНСТАНТЫ
 * =========================================================================== */

#define API_DEFAULT_PORT    4028    /* Порт по умолчанию */
#define API_MAX_RESPONSE    8192    /* Максимальный размер ответа */
#define API_TASK_PRIORITY   3       /* Приоритет задачи API */

/* ===========================================================================
 * ПРОТОТИПЫ ФУНКЦИЙ
 * =========================================================================== */

/**
 * @brief Запуск API сервера
 * 
 * @param port  Порт для прослушивания
 * @return      0 при успехе
 */
int api_server_start(int port);

/**
 * @brief Остановка API сервера
 */
void api_server_stop(void);

/**
 * @brief Обработка API запроса
 * 
 * @param request   Строка запроса (команда)
 * @param response  Буфер для ответа
 * @param resp_len  Размер буфера
 * @return          Длина ответа
 */
int api_handle_request(const char *request, char *response, int resp_len);

#endif /* __API_H__ */
